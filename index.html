<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="refresh" content="5"> <!-- Refresca cada 5s -->
<title>Dashboard Gases ESP32</title>

<style>
    body {
        background-color: #4B0082; /* Morado */
        color: white;
        font-family: "Times New Roman", serif;
        margin: 0;
        padding: 20px;
    }

    h1, h2, h3 {
        text-align: center;
    }

    .status {
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 20px;
    }

    .container {
        display: flex;
        justify-content: space-between;
        width: 100%;
    }

    table {
        background: rgba(255,255,255,0.15);
        padding: 10px;
        border-radius: 12px;
        width: 45%;
    }

    table td {
        padding: 6px;
        border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    .corner-img {
        position: absolute;
        width: 90px;
        opacity: 0.9;
    }

    #logo_tl { top: 10px; left: 10px; }
    #logo_tr { top: 10px; right: 10px; }
    #logo_bl { bottom: 10px; left: 10px; }
    #logo_br { bottom: 10px; right: 10px; }

</style>

<script>
// IP fija del ESP32
const espIP = "http://192.168.100.55/data";

// Variables para cambio ‚â•10%
let lastCO2 = null;
let lastCO  = null;

async function getData() {
    let statusField = document.getElementById("status");

    try {
        const response = await fetch(espIP, { method: "GET", mode: "cors" });

        if (!response.ok) throw new Error("Error");

        const data = await response.json();

        statusField.innerHTML = "üü¢ ESP32 Conectado";

        updateIfChanged("co2_table", "CO2", data.co2, "lastCO2");
        updateIfChanged("co_table", "CO", data.co, "lastCO");

    } catch (e) {
        statusField.innerHTML = "üî¥ ESP32 Desconectado";
    }
}

function updateIfChanged(tableID, label, newValue, varName) {
    let last = window[varName];

    if (last === null || Math.abs(newValue - last) >= last * 0.10) {
        window[varName] = newValue;

        let table = document.getElementById(tableID);
        let row = table.insertRow(-1);

        let c1 = row.insertCell(0);
        let c2 = row.insertCell(1);

        c1.innerHTML = label;
        c2.innerHTML = newValue + " ppm";
    }
}

setInterval(getData, 3000);
</script>

</head>
<body>

<!-- LOGOS EN ESQUINAS -->
<img id="logo_tl" class="corner-img" src="https://raw.githubusercontent.com/lisjimmy505/carro/main/logo.png">
<img id="logo_tr" class="corner-img" src="https://raw.githubusercontent.com/lisjimmy505/carro/main/carro.png">
<img id="logo_bl" class="corner-img" src="https://raw.githubusercontent.com/lisjimmy505/carro/main/logo.png">
<img id="logo_br" class="corner-img" src="https://raw.githubusercontent.com/lisjimmy505/carro/main/carro.png">

<h1>Panel de Monitoreo de Gases</h1>
<div id="status" class="status">Verificando conexi√≥n...</div>

<div class="container">
    
    <!-- TABLA CO2 -->
    <table id="co2_table">
        <tr><th colspan="2">Sensor MQ-135 (CO‚ÇÇ)</th></tr>
    </table>

    <!-- TABLA CO -->
    <table id="co_table">
        <tr><th colspan="2">Sensor MQ-9 (CO)</th></tr>
    </table>

</div>

</body>
</html>
